<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/LOGO.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <title>Dashboard Admin</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }

        /* SIDEBAR */
        .sidebar {
            width: 230px;
            height: 100vh;
            background: #111827;
            color: #fff;
            position: fixed;
            padding: 20px;
        }

        .sidebar .logo {
            font-size: 22px;
            margin-bottom: 25px;
            text-align: center;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar ul li {
            margin: 15px 0;
        }

        .sidebar ul li a {
            text-decoration: none;
            color: #cbd5e1;
            font-size: 16px;
            padding: 10px;
            display: block;
            border-radius: 8px;
            transition: .3s;
        }

        .sidebar ul li.active a,
        .sidebar ul li a:hover {
            background: #1e293b;
            color: #fff;
        }

        /* MAIN AREA */
        .main {
            margin-left: 230px;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        header .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        header img {
            width: 40px;
            border-radius: 50%;
        }

        /* CARDS */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            box-shadow: 2px 2px 10px #0001;
        }

        .card p {
            font-size: 26px;
            margin-top: 10px;
        }

        /* CONTENT BOXES */
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .box {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 2px 2px 10px #0001;
        }

        .fake-chart {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #4ade80, #60a5fa);
            border-radius: 8px;
            margin-top: 15px;
        }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .sidebar {
                width: 180px;
            }
            .main {
                margin-left: 180px;
            }
        }



        .pesquisa-container {
        position: relative;
        width: 350px;
    }

    #barraPesquisa {
        width: 100%;
        padding: 10px;
        font-size: 16px;
    }

    .lista-resultado {
        list-style: none;      /* remove os pontos (•) */
        padding-left: 0;       /* impede recuo padrão */
        margin: 0;             /* remove margens externas */
    }

    .lista-resultado li {
        padding: 8px 0;
        border-bottom: 1px solid rgba(255,255,255,0.4); /* opcional */
    }

    .lista-resultado li:hover {
        background: #f1f1f1;
    }

    </style>

</head>
<body class="role-user">
  <div class="page-container">
    {% include 'header.html' %}

    <main class="home-dashboard">
        <section class="cards">
                <div class="card">
                    <h3>Usuários</h3>
                    <p>{{ users_count }}</p>
                </div>
            </section>

            <section class="content">
                <div class="box">
                    <h2>Gráfico Simples</h2>
                    <div class="fake-chart">


                        <div class="pesquisa-container">
                            <input type="text" id="barraPesquisa" placeholder="Pesquisar matrícula...">

                            <ul id="resultadoPesquisa" class="lista-resultado"></ul>
                        </div>


                    </div>
                </div>

                <div class="box">
                    <h2>Atividades Recentes</h2>
                    <ul class="activity-list">
                        <li>+ Novo usuário cadastrado</li>
                        <li>+ Visita registrada no museu</li>
                        <li>+ Novo agendamento realizado</li>
                        <li>- Agendamento cancelado</li>
                    </ul>
                </div>
            </section>
    </div>
    </main>
</div>


<script>
let usuarios = [];

function carregarUsuarios() {
    fetch("/api/usuarios")
        .then(res => res.json())
        .then(data => {
            usuarios = data.usuarios;
        })
        .catch(err => console.error("Erro ao carregar usuários:", err));
}

// Carrega ao abrir a página
carregarUsuarios();

// Atualiza em real-time a cada 5 segundos
setInterval(carregarUsuarios, 5000);


const barra = document.getElementById("barraPesquisa");
const lista = document.getElementById("resultadoPesquisa");

// Quando focar → exibe os 8 primeiros
barra.addEventListener("focus", () => {
    exibirResultados(usuarios);
    lista.style.display = "block";
});

// Quando digitar
barra.addEventListener("input", () => {
    const termo = barra.value.trim();

    let filtrados = usuarios;

    // Se digitou algo, filtra
    if (termo !== "") {
        filtrados = usuarios.filter(u =>
            u.matricula.startsWith(termo)
        );
    }

    exibirResultados(filtrados);
    lista.style.display = "block";
});

// Quando perder o foco → esconde a lista
barra.addEventListener("blur", () => {
    setTimeout(() => {
        lista.style.display = "none";
    }, 150); 
});

// Exibir resultados
function exibirResultados(listaUsuarios) {
    lista.innerHTML = "";

    // limitar a 8 resultados
    listaUsuarios.slice(0, 8).forEach(u => {
        const item = document.createElement("li");
        item.textContent = `${u.name} — ${u.matricula}`;
        lista.appendChild(item);
    });
}
</script>


</body>
</html>