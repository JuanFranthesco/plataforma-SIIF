<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil de {{ current_user.name }} - SIIF</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

</head>

<body class="role-user"> 
  <div class="page-container">

    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container-fluid">
        <a class="navbar-brand" href="{{ url_for('main.tela_inicial') }}">
          <img src="{{ url_for('static', filename='LOGO.png') }}" alt="Logo SIIF" style="filter: brightness(0) invert(1);">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <i class="bi bi-list text-white fs-1"></i> 
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.tela_inicial') }}"><i class="bi bi-house-door-fill"></i> Página Inicial</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.tela_foruns') }}"><i class="bi bi-chat-left-dots-fill"></i> Fóruns</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.tela_divulgacao') }}"><i class="bi bi-megaphone-fill"></i> Divulgação</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.tela_materiais') }}"><i class="bi bi-file-earmark-text-fill"></i> Materiais</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('main.tela_mapa') }}"><i class="bi bi-geo-alt-fill"></i> Mapa</a>
            </li>
          </ul>
          <a href="{{ url_for('main.tela_perfil') }}" class="profile-link ms-lg-auto">
            <span>Olá, {{ current_user.name }}</span>
            <div class="profile-pic">
              <img src="{{ url_for('static', filename='image.png') }}" alt="Perfil"> 
            </div>
          </a>
        </div>
      </div>
    </nav>

    <main>
      
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="container-fluid" style="margin-top: 20px;">
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <div class="profile-header-container">
        
        <div class="profile-banner" style="background-image: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=2070&auto=format&fit=crop');">
        </div>

        <div class="profile-info-bar">
          
          <img src="{{ url_for('static', filename='image.png') }}" alt="Avatar do usuário" class="profile-avatar">

          <div class="profile-actions">
            <div class="dropdown">
              <button class="btn btn-icon" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-three-dots"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="#"><i class="bi bi-share-fill me-2"></i> Compartilhar Perfil</a></li>
                <li><a class="dropdown-item" href="{{ url_for('main.suporte') }}"><i class="bi bi-headset me-2"></i> Ir para Suporte</a></li>
              </ul>
            </div>
            
            <button class="btn btn-edit-profile" data-bs-toggle="modal" data-bs-target="#modalEditarPerfil">
              EDITAR PERFIL
            </button>
          </div>

          <div class="profile-user-details">
            <h2 class="profile-name">{{ current_user.name }}</h2>
            <p class="profile-bio">{{ current_user.perfil.bio or 'Sem bio definida. Edite seu perfil para adicionar uma.' }}</p>
            <p class="profile-course">
              <i class="bi bi-mortarboard-fill"></i>
              {{ current_user.perfil.curso or 'Curso não informado' }} – {{ current_user.perfil.campus or 'Campus não informado' }}
            </p>
            </div>

        </div>
      </div>

      <div class="profile-content">
        
        <ul class="nav profile-tabs" id="profileTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="posts-tab" data-bs-toggle="tab" data-bs-target="#posts-tab-pane" type="button" role="tab" aria-controls="posts-tab-pane" aria-selected="true">
              Posts no Fórum
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="materiais-tab" data-bs-toggle="tab" data-bs-target="#materiais-tab-pane" type="button" role="tab" aria-controls="materiais-tab-pane" aria-selected="false">
              Materiais Compartilhados
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="salvos-tab" data-bs-toggle="tab" data-bs-target="#salvos-tab-pane" type="button" role="tab" aria-controls="salvos-tab-pane" aria-selected="false">
              Itens Salvos
            </button>
          </li>
        </ul>

        <div class="tab-content" id="profileTabContent">
          
          <div class="tab-pane fade show active" id="posts-tab-pane" role="tabpanel" aria-labelledby="posts-tab" tabindex="0">
            
            <article class="post-card-profile">
              <div class="post-card-header">
                <img src="{{ url_for('static', filename='image.png') }}" alt="Avatar" class="post-card-avatar">
                <div class="post-card-info">
                  <strong>{{ current_user.name }}</strong>
                  <span class="text-muted">• há 15min</span>
                </div>
                <div class="dropdown ms-auto">
                  <button class="btn btn-light btn-sm btn-icon-sm" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-three-dots-vertical"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="#"><i class="bi bi-bookmark-fill me-2"></i> Salvar Post</a></li>
                    <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-flag-fill me-2"></i> Denunciar</a></li>
                  </ul>
                </div>
              </div>
              <div class="post-card-body">
                <h5 class="post-card-title">Preciso de informações sobre os Tal</h5>
                <p>Olá! Eu gostria que alguém pudesse me orientar sobre como funcionam as aulas particulares com os Tal. Estou procurando pois irei bombar na matéria do prof. Derilson, porém não encontro nenhum professor particular que atenda primatas. Alguém pode me ajudar?</p>
              </div>
              
              <div class="post-card-footer">
                <a href="#" class="post-interaction-btn"> <i class="bi bi-arrow-up-circle-fill"></i> 15 </a>
                <a href="#" class="post-interaction-btn"> <i class="bi bi-arrow-down-circle-fill"></i> 0 </a>
                <a href="#" class="post-interaction-btn" role="button" data-bs-toggle="collapse" data-bs-target="#comments-profile-post-1" aria-expanded="false" aria-controls="comments-profile-post-1">
                  <i class="bi bi-chat-fill"></i> 3
                </a>
              </div>

              <div class="collapse comments-section" id="comments-profile-post-1">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="mb-0" style="color: #386641; font-weight: 600;">Comentários</h5>
                  <button type="button" class="btn btn-sm new-comment-btn" data-bs-toggle="modal" data-bs-target="#modalComentar">
                    Comentar
                  </button>
                </div>

                <div class="vstack gap-3">
                  <div class="single-comment">
                    <img class="contact-avatar-sm" src="https://placehold.co/32x32/ddd/fff?text=A11" alt="Avatar">
                    <div class="flex-grow-1">
                      <p class="fw-bold text-success mb-0">Aluno 11</p>
                      <p class="mb-0">Procura no site oficial. Tem várias!</p>
                    </div>
                  </div>
                  <div class="single-comment">
                    <img class="contact-avatar-sm" src="https://placehold.co/32x32/eee/fff?text=A404" alt="Avatar">
                    <div class="flex-grow-1">
                      <p class="fw-bold text-success mb-0">Aluno 404</p>
                      <p class="mb-0">Não</p>
                    </div>
                  </div>
                </div>
              </div>
              </article>
            
          </div>

          <div class="tab-pane fade" id="materiais-tab-pane" role="tabpanel" aria-labelledby="materiais-tab" tabindex="0">
            <p class="text-center text-muted p-5">Nenhum material compartilhado ainda.</p>
            </div>

          <div class="tab-pane fade" id="salvos-tab-pane" role="tabpanel" aria-labelledby="salvos-tab" tabindex="0">
             <p class="text-center text-muted p-5">Aqui ficam seus itens salvos.</p>
             </div>
        </div>

      </div>
      
    </main>
    
    <footer class="site-footer">
        <div class="container-fluid">
          <div class="row">
            
            <div class="col-md-4 mb-4 mb-md-0">
              <a href="{{ url_for('main.tela_inicial') }}" class="footer-logo">
                <img src="{{ url_for('static', filename='LOGO.png') }}" alt="Logo SIIF">
                <span>SIIF</span>
              </a>
              <p class="footer-copyright">
                © 2025 SIIF - Sistema de Interação do Instituto Federal.<br>
                Projeto acadêmico desenvolvido por alunos do IFRN.
              </p>
            </div>
      
            <div class="col-md-4 mb-4 mb-md-0">
              <h5>Navegação</h5>
              <ul class="list-unstyled footer-links">
                <li><a href="{{ url_for('main.tela_inicial') }}"><i class="bi bi-house-door-fill"></i> Página Inicial</a></li>
                <li><a href="{{ url_for('main.tela_foruns') }}"><i class="bi bi-chat-left-dots-fill"></i> Fóruns</a></li>
                <li><a href="{{ url_for('main.tela_divulgacao') }}"><i class="bi bi-megaphone-fill"></i> Divulgação</a></li>
                <li><a href="{{ url_for('main.tela_materiais') }}"><i class="bi bi-file-earmark-text-fill"></i> Materiais</a></li>
                <li><a href="{{ url_for('main.tela_mapa') }}"><i class="bi bi-geo-alt-fill"></i> Mapa</a></li>
              </ul>
            </div>
      
            <div class="col-md-4">
              <h5>Links Úteis</h5>
              <ul class="list-unstyled footer-links">
                <li><a href="https://www.gov.br/ifrn/pt-br" target="_blank">Site Oficial IFRN</a></li>
                <li><a href="https://suap.ifrn.edu.br/" target="_blank">Acessar SUAP</a></li>
                <li><a href="{{ url_for('main.suporte') }}">Suporte & Denúncias</a></li>
                <li><a href="{{ url_for('main.tela_perfil') }}">Meu Perfil</a></li>
              </ul>
            </div>
      
          </div>
        </div>
      </footer>

  </div> 
  
  <a href="{{ url_for('main.suporte') }}" class="help-btn help-btn-user"><i class="bi bi-headset"></i></a>
  <a href="{{ url_for('main.tela_denuncias') }}" class="help-btn help-btn-admin"><i class="bi bi-shield-check"></i></a>

  <div class="modal fade" id="modalEditarPerfil" tabindex="-1" aria-labelledby="modalEditarPerfilLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-custom-verde"> 
      <div class="modal-content">
      
        <form method="POST" action="{{ url_for('main.tela_perfil') }}">
          
          {{ form.hidden_tag() }} <div class="modal-header">
            <h1 class="modal-title fs-5" id="modalEditarPerfilLabel">Editar Perfil</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          
          <div class="modal-body">
            <div class="mb-3">
              <label for="inputBanner" class="form-label fw-bold">Alterar Banner</label>
              <input class="form-control" type="file" id="inputBanner" accept="image/*" disabled> </div>
            <div class="mb-3">
              <label for="inputFotoPerfil" class="form-label fw-bold">Alterar Foto de Perfil</label>
              <input class="form-control" type="file" id="inputFotoPerfil" accept="image/*" disabled>
            </div>
            
            <div class="mb-3">
              {{ form.bio.label(class="form-label fw-bold") }}
              {{ form.bio(class="form-control", id="inputBio", rows="3") }}
              {% for error in form.bio.errors %}<span class="text-danger">{{ error }}</span>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.curso.label(class="form-label fw-bold") }}
              {{ form.curso(class="form-control", id="inputCurso", placeholder="Ex: Informática") }}
              {% for error in form.curso.errors %}<span class="text-danger">{{ error }}</span>{% endfor %}
            </div>
            
            <div class="mb-3">
              {{ form.campus.label(class="form-label fw-bold") }}
              {{ form.campus(class="form-control", id="inputCampus", placeholder="Ex: IFRN Apodi") }}
              {% for error in form.campus.errors %}<span class="text-danger">{{ error }}</span>{% endfor %}
            </div>
            
            </div>
          
          <div class="modal-footer" style="background-color: #F8F9FA;">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            {{ form.submit(class="btn btn-success", style="background-color: #386641; border-color: #386641;") }}
          </div>

        </form> </div>
    </div>
  </div>
  
  <div class="modal fade" id="modalComentar" tabindex="-1" aria-labelledby="modalComentarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-custom-verde">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="modalComentarLabel">Escrever Comentário</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <textarea class="form-control" rows="5" placeholder="No que está pensando?" aria-label="Campo para escrever seu comentário"></textarea>
        </div>
        <div class="modal-footer d-flex justify-content-between">
          <button type="button" class="btn btn-link" style="color: #386641; text-decoration: none;">
            <i class="bi bi-paperclip"></i> Anexar Mídia
          </button>
          <button type="button" class="btn btn-primary filter-btn">Comentar</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Pega o hash da URL (ex: #salvos-tab)
      const hash = window.location.hash;
      if (hash) {
        
        // O seletor foi trocado de '.nav-tabs' para '.profile-tabs'
        const tabTrigger = document.querySelector(`.profile-tabs button[id="${hash.substring(1)}"]`);
        
        if (tabTrigger) {
          // "Clica" na tab para ativá-la
          const tab = new bootstrap.Tab(tabTrigger);
          tab.show();
        }
      }
    });
  </script>
  
</body>
</html>
