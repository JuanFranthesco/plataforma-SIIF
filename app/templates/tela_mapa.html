{% extends "base.html" %}

{% block title %}Localizador de Campi - SIIF{% endblock %}

{% block head_extras %}
<style>
    /* Layout de duas colunas com altura total */
    .map-layout {
        display: flex;
        gap: 20px;
        height: calc(100vh - 140px); /* Ajusta para caber na tela sem scroll global */
        min-height: 600px;
    }

    /* Coluna da Lista (Esquerda) */
    .campus-list-col {
        width: 350px;
        display: flex;
        flex-direction: column;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        overflow: hidden;
    }

    .search-header {
        padding: 20px;
        background-color: #386641;
        color: white;
    }

    .campus-scroll-area {
        flex-grow: 1;
        overflow-y: auto;
        padding: 10px;
    }

    /* Item da Lista */
    .campus-item {
        display: block;
        padding: 15px;
        margin-bottom: 8px;
        border-radius: 10px;
        background-color: #f8f9fa;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
    }

    .campus-item:hover {
        background-color: #e8f5e9;
        transform: translateX(5px);
    }

    .campus-item.active {
        background-color: #386641;
        color: white;
        box-shadow: 0 4px 10px rgba(56, 102, 65, 0.3);
    }

    .campus-item h6 { margin: 0; font-weight: 600; }
    .campus-item small { opacity: 0.8; }

    /* Coluna do Mapa (Direita) */
    .map-display-col {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .map-frame-wrapper {
        flex-grow: 1;
        background: #e9ecef;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        position: relative;
        min-height: 300px;
    }

    .map-frame-wrapper iframe {
        width: 100%;
        height: 100%;
        border: 0;
    }

    /* Card de Detalhes */
    .campus-details-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        display: flex;
        align-items: flex-start;
        gap: 30px;
        min-height: 150px;
    }

    .detail-icon-box {
        width: 60px;
        height: 60px;
        background-color: #e8f5e9;
        color: #386641;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        flex-shrink: 0;
    }

    /* Responsividade */
    @media (max-width: 992px) {
        .map-layout { flex-direction: column; height: auto; }
        .campus-list-col { width: 100%; height: 300px; }
        .map-frame-wrapper { height: 400px; }
    }
</style>
{% endblock %}

{% block content %}
<main class="home-dashboard" style="background-color: #f4f6f8;">
    <div class="container-fluid px-4 py-3">
        
        <div class="d-flex align-items-center mb-3">
            <a href="{{ url_for('main.tela_ferramentas') }}" class="btn btn-white rounded-circle shadow-sm me-3 text-dark">
                <i class="bi bi-arrow-left"></i>
            </a>
            <h4 class="fw-bold mb-0" style="color: #386641;">Mapa dos Campi</h4>
        </div>

        <div class="map-layout">
            
            <div class="campus-list-col">
                <div class="search-header">
                    <h5 class="mb-3"><i class="bi bi-geo-alt-fill me-2"></i>Escolha o Campus</h5>
                    <div class="input-group">
                        <span class="input-group-text border-0 bg-white bg-opacity-25 text-white">
                            <i class="bi bi-search"></i>
                        </span>
                        <input type="text" id="campus-search" class="form-control border-0 bg-white bg-opacity-10 text-white placeholder-white" placeholder="Buscar cidade..." style="color: #fff;">
                    </div>
                </div>
                <div class="campus-scroll-area" id="campus-list-container">
                    </div>
            </div>

            <div class="map-display-col">
                
                <div class="map-frame-wrapper">
                    <iframe id="map-frame" src="" loading="lazy"></iframe>
                    <div id="map-placeholder" class="position-absolute top-50 start-50 translate-middle text-center text-muted" style="display: none;">
                        <i class="bi bi-map display-1 opacity-25"></i>
                        <p class="mt-2">Selecione um campus na lista ao lado.</p>
                    </div>
                </div>

                <div class="campus-details-card">
                    <div class="detail-icon-box">
                        <i class="bi bi-building"></i>
                    </div>
                    <div class="flex-grow-1">
                        <h3 class="fw-bold mb-3" id="detail-title" style="color: #386641;">Selecione um Campus</h3>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <p class="mb-1 text-muted small"><i class="bi bi-geo-alt me-1"></i> ENDEREÇO</p>
                                <p class="fw-bold mb-0" id="detail-address">---</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1 text-muted small"><i class="bi bi-telephone me-1"></i> CONTATO</p>
                                <p class="fw-bold mb-0" id="detail-phone">---</p>
                            </div>
                            <div class="col-12">
                                <p class="mb-1 text-muted small"><i class="bi bi-info-circle me-1"></i> SOBRE</p>
                                <p class="text-secondary mb-0" id="detail-desc" style="line-height: 1.5;">---</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <a id="btn-external-map" href="#" target="_blank" class="btn btn-outline-success rounded-pill px-4 disabled">
                            Abrir no Google Maps <i class="bi bi-box-arrow-up-right ms-2"></i>
                        </a>
                    </div>
                </div>

            </div>
        </div>

    </div>
</main>
{% endblock %}

{% block scripts %}
<script>
    // --- DADOS DOS CAMPI (Preservados do seu código original) ---
    const campusData = {
        "apodi": {
            titulo: "Campus Apodi",
            endereco: "Chapada do Apodi - RN-233, Km 02, 1000",
            cidade: "Apodi",
            telefone: "(84) 4005-4101",
            descricao: "O Campus Apodi destaca-se pela sua grande fazenda escola e forte atuação nas áreas de agropecuária e informática.",
            mapa: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3972.498363720977!2d-37.81223948523351!3d-5.653116595830256!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x7ba354397730e61%3A0x6ec0a33e2260662!2sIFRN%20-%20Campus%20Apodi!5e0!3m2!1spt-BR!2sbr!4v1620000000000!5m2!1spt-BR!2sbr"
        },
        "natal-central": {
            titulo: "Campus Natal Central",
            endereco: "Av. Sen. Salgado Filho, 1559 - Tirol",
            cidade: "Natal",
            telefone: "(84) 4005-9800",
            descricao: "O maior e mais antigo campus, referência histórica em educação profissional no estado.",
            mapa: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3969.319642546306!2d-35.20658768523166!3d-5.810373595789851!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x7b2ff9c5f5f5f5f%3A0x5f5f5f5f5f5f5f5f!2sIFRN%20-%20Campus%20Natal-Central!5e0!3m2!1spt-BR!2sbr"
        },
        "mossoro": {
            titulo: "Campus Mossoró",
            endereco: "R. Raimundo Firmino de Oliveira, 400",
            cidade: "Mossoró",
            telefone: "(84) 3312-3100",
            descricao: "Principal polo de educação tecnológica da região Oeste Potiguar, com foco em petróleo e gás.",
            mapa: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3974.205263152777!2d-37.35081168523456!3d-5.228987596195616!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x7ba07705f5f5f5f%3A0x5f5f5f5f5f5f5f5f!2sIFRN%20Campus%20Mossor%C3%B3!5e0!3m2!1spt-BR!2sbr"
        },
        "caico": {
            titulo: "Campus Caicó",
            endereco: "RN-288, s/n - Nova Caicó",
            cidade: "Caicó",
            telefone: "(84) 4005-4102",
            descricao: "Referência no Seridó, com cursos voltados para o setor têxtil e informática.",
            mapa: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3964.739777934257!2d-37.0855!3d-6.4275!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x7a50505f5f5f5f%3A0x5f5f5f5f5f5f5f5f!2sIFRN%20Campus%20Caic%C3%B3!5e0!3m2!1spt-BR!2sbr"
        },
        "currais-novos": {
            titulo: "Campus Currais Novos",
            endereco: "Rua Manoel Lopes Filho, 773",
            cidade: "Currais Novos",
            telefone: "(84) 4005-4103",
            descricao: "Destaca-se na área de alimentos e mineração na região do Seridó.",
            mapa: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3965.5!2d-36.5!3d-6.2!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2sIFRN!5e0!3m2!1spt-BR!2sbr"
        },
        "parnamirim": {
            titulo: "Campus Parnamirim",
            endereco: "R. Antônia de Lima Paiva, 155",
            cidade: "Parnamirim",
            telefone: "(84) 4005-4108",
            descricao: "Focado em mecatrônica e informática, localizado na região metropolitana.",
            mapa: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3968.5!2d-35.25!3d-5.9!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2sIFRN!5e0!3m2!1spt-BR!2sbr"
        }
        // Adicione outros campi aqui seguindo o mesmo padrão
    };

    // --- LÓGICA DE RENDERIZAÇÃO ---
    
    function renderList(filterText = "") {
        const container = document.getElementById('campus-list-container');
        container.innerHTML = ""; // Limpa lista

        Object.keys(campusData).forEach(key => {
            const data = campusData[key];
            
            // Filtro de busca
            if (filterText && !data.titulo.toLowerCase().includes(filterText) && !data.cidade.toLowerCase().includes(filterText)) {
                return;
            }

            // Cria o elemento da lista
            const item = document.createElement('div');
            item.className = 'campus-item shadow-sm';
            item.onclick = () => selectCampus(key, item);
            item.innerHTML = `
                <h6>${data.titulo}</h6>
                <small><i class="bi bi-geo-alt-fill me-1"></i>${data.cidade}</small>
            `;
            container.appendChild(item);
        });
    }

    function selectCampus(key, element) {
        const data = campusData[key];
        if (!data) return;

        // Atualiza visual da lista (Active)
        document.querySelectorAll('.campus-item').forEach(el => el.classList.remove('active'));
        if (element) element.classList.add('active');

        // Atualiza Detalhes
        document.getElementById('detail-title').textContent = data.titulo;
        document.getElementById('detail-address').textContent = data.endereco;
        document.getElementById('detail-phone').textContent = data.telefone;
        document.getElementById('detail-desc').textContent = data.descricao;

        // Atualiza Mapa
        const iframe = document.getElementById('map-frame');
        const placeholder = document.getElementById('map-placeholder');
        
        if (data.mapa) {
            iframe.style.display = 'block';
            placeholder.style.display = 'none';
            iframe.src = data.mapa;
            
            // Botão externo
            const btnExt = document.getElementById('btn-external-map');
            btnExt.href = data.mapa; // Nota: links embed nem sempre abrem bem direto, ideal ter link normal
            btnExt.classList.remove('disabled');
        } else {
            iframe.style.display = 'none';
            placeholder.style.display = 'block';
        }
    }

    // --- EVENTOS ---
    document.getElementById('campus-search').addEventListener('input', (e) => {
        renderList(e.target.value.toLowerCase());
    });

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
        renderList();
        // Seleciona o primeiro campus automaticamente para não ficar vazio
        const firstKey = Object.keys(campusData)[0];
        const firstItem = document.querySelector('.campus-item');
        if (firstKey && firstItem) {
            selectCampus(firstKey, firstItem);
        }
    });

</script>
{% endblock %}
